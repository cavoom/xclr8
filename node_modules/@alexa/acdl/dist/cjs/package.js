"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.loadGeneratedInteractionModelModules = exports.loadGeneratedInteractionModelModulesSync = exports.scanPackages = exports.scanPackagesSync = exports.loadSlotTypes = exports.loadInteractionModelsContent = exports.loadInteractionModelsContentSync = exports.getInteractionModelFiles = exports.getInteractionModelFilesSync = exports.loadResponseTemplates = exports.loadResponseTemplatesSync = exports.loadBundledPackage = exports.loadBundledPackageSync = exports.loadSourceDirectory = exports.loadSourceDirectorySync = exports.loadPackageConfig = exports.loadPackageConfigSync = exports.loadPackage = exports.loadPackageSync = exports.DefaultInclude = exports.DefaultBuildDir = exports.ProjectVersion = void 0;
const path_1 = __importDefault(require("path"));
const fs_extra_1 = __importDefault(require("fs-extra"));
const ask = __importStar(require("./ast"));
const source_file_1 = require("./source-file");
const util_1 = require("./util");
const constants_1 = require("./constants");
const parse_1 = require("./parse");
const error_factory_1 = require("./error-factory");
const im_module_generator_1 = require("./im-module-generator");
const transformUIProject_1 = require("./transformUIProject");
/**
 * Enum for specifying the version of an ASK Project.
 */
var ProjectVersion;
(function (ProjectVersion) {
    /**
     * Beta 1 project version requires no package.json - everything is driven by `ask-resources.json` or file system convention.
     */
    ProjectVersion["Beta1"] = "beta1";
    /**
     * Beta 2 project is a standard NPM package driven by `package.json` or `ask.json`. Everything is driven by configuration.
     */
    ProjectVersion["Beta2"] = "beta2";
    ProjectVersion["SingleFile"] = "single";
    ProjectVersion["Latest"] = "beta2";
})(ProjectVersion = exports.ProjectVersion || (exports.ProjectVersion = {}));
/**
 * Default directory to synthesize ASKIR JSON files and other assets to during compilation.
 */
exports.DefaultBuildDir = "build";
/**
 * Default directory relative to the project root to look for ACDL files.
 */
exports.DefaultInclude = "src";
/**
 * Load a package's modules from the file system.
 *
 * package is identified by a `package.json` file - an ASK package must be a valid NPM package.
 *
 * Additionally, an ASK package either contains an `ask` section in `package.json` or as a supplemental `ask.json` file.
 *
 * @param rootDir root directory of the package
 * @param config optional configuration for the package - it will be loaded from the file system if not provided.
 * @param isSrc set to true if this is a source package, false otherwise
 */
function loadPackageSync(rootDir, config, isSrc) {
    var _a, _b;
    config = config !== null && config !== void 0 ? config : loadPackageConfigSync(rootDir);
    const isLibrary = (_b = (_a = config === null || config === void 0 ? void 0 : config.ask) === null || _a === void 0 ? void 0 : _a.library) !== null && _b !== void 0 ? _b : false;
    if (isSrc && config === undefined) {
        // we're in a legacy configuration (no package.json file)
        const skillPackageDir = path_1.default.join(rootDir, "skill-package");
        const [modules, interactionModelFiles, responseTemplates] = [
            loadSourceDirectorySync(path_1.default.join(rootDir, "skill-package", "conversations")).filter((m) => m.content !== undefined),
            getInteractionModelFilesSync(skillPackageDir),
            loadResponseTemplatesSync(skillPackageDir),
        ];
        const interactionModels = loadInteractionModelsContentSync(interactionModelFiles);
        // Don't generate IM ASKIR modules if it's a UI skill
        const { isUISkill } = (0, transformUIProject_1.getUISkillInformation)(modules);
        const interactionModelModules = isUISkill
            ? []
            : loadGeneratedInteractionModelModulesSync(rootDir, interactionModelFiles, isSrc, isLibrary);
        const slotTypes = loadSlotTypes(interactionModels);
        return {
            interactionModels: interactionModelFiles,
            modules: [...modules, ...interactionModelModules],
            responseTemplates,
            slotTypes,
        };
    }
    if ((config === null || config === void 0 ? void 0 : config.ask) === undefined) {
        throw new Error(`'${rootDir}' is not a valid ASKIR package`);
    }
    else {
        const [interactionModelFiles, responseTemplates] = [getInteractionModelFilesSync(rootDir), loadResponseTemplatesSync(rootDir)];
        const interactionModels = loadInteractionModelsContentSync(interactionModelFiles);
        const slotTypes = loadSlotTypes(interactionModels);
        // load files from `srcDir` if this is a source package, otherwise `outDir`
        const moduleDir = isSrc ? config.ask.srcDir : config.ask.outDir;
        const absoluteModuleDir = path_1.default.isAbsolute(moduleDir) ? moduleDir : path_1.default.join(rootDir, moduleDir);
        const sourceModules = loadSourceDirectorySync(absoluteModuleDir).filter((m) => m.content !== undefined);
        const { isUISkill } = (0, transformUIProject_1.getUISkillInformation)(sourceModules);
        // Skip IM generation if it's a UI skill
        const interactionModelModules = isUISkill
            ? []
            : loadGeneratedInteractionModelModulesSync(absoluteModuleDir, interactionModelFiles, isSrc, isLibrary);
        if ((0, util_1.isDirSync)(absoluteModuleDir)) {
            return {
                config,
                modules: [...sourceModules, ...interactionModelModules],
                responseTemplates,
                slotTypes,
                interactionModels: interactionModelFiles,
            };
        }
    }
    return undefined;
}
exports.loadPackageSync = loadPackageSync;
/**
 * Load a package's modules from the file system.
 *
 * package is identified by a `package.json` file - an ASK package must be a valid NPM package.
 *
 * Additionally, an ASK package either contains an `ask` section in `package.json` or as a supplemental `ask.json` file.
 *
 * @param rootDir root directory of the package
 * @param config optional configuration for the package - it will be loaded from the file system if not provided.
 * @param isSrc set to true if this is a source package, false otherwise
 */
async function loadPackage(rootDir, config, isSrc) {
    var _a, _b;
    config = config !== null && config !== void 0 ? config : (await loadPackageConfig(rootDir));
    const isLibrary = (_b = (_a = config === null || config === void 0 ? void 0 : config.ask) === null || _a === void 0 ? void 0 : _a.library) !== null && _b !== void 0 ? _b : false;
    if (isSrc && config === undefined) {
        // we're in a legacy configuration (no package.json file)
        const skillPackageDir = path_1.default.join(rootDir, "skill-package");
        const baseDir = path_1.default.join(rootDir, "skill-package", "conversations");
        const [modules, interactionModelFiles, responseTemplates] = await Promise.all([
            loadSourceDirectory(path_1.default.join(rootDir, "skill-package", "conversations")).then((modules) => modules.filter((m) => m.content !== undefined)),
            getInteractionModelFiles(skillPackageDir),
            loadResponseTemplates(skillPackageDir),
        ]);
        const interactionModels = await loadInteractionModelsContent(interactionModelFiles);
        // Don't generate IM ASKIR modules if it's a UI skill
        const { isUISkill } = (0, transformUIProject_1.getUISkillInformation)(modules);
        const interactionModelModules = isUISkill
            ? []
            : await loadGeneratedInteractionModelModules(baseDir, interactionModelFiles, isSrc, isLibrary);
        const slotTypes = loadSlotTypes(interactionModels);
        return {
            interactionModels: interactionModelFiles,
            modules: [...modules, ...interactionModelModules],
            responseTemplates,
            slotTypes,
        };
    }
    if ((config === null || config === void 0 ? void 0 : config.ask) === undefined) {
        throw new Error(`'${rootDir}' is not a valid ASKIR package`);
    }
    else {
        const [interactionModelFiles, responseTemplates] = await Promise.all([
            getInteractionModelFiles(rootDir),
            loadResponseTemplates(rootDir),
        ]);
        const interactionModels = await loadInteractionModelsContent(interactionModelFiles);
        const slotTypes = loadSlotTypes(interactionModels);
        // load files from `srcDir` if this is a source package, otherwise `outDir`
        const moduleDir = isSrc ? config.ask.srcDir : config.ask.outDir;
        const absoluteModuleDir = path_1.default.isAbsolute(moduleDir) ? moduleDir : path_1.default.join(rootDir, moduleDir);
        // Skip IM generation if it's a UI skill
        const sourceModules = (await loadSourceDirectory(absoluteModuleDir)).filter((m) => m.content !== undefined);
        // Don't generate IM ASKIR modules if it's a UI skill
        const { isUISkill } = (0, transformUIProject_1.getUISkillInformation)(sourceModules);
        const interactionModelModules = isUISkill
            ? []
            : await loadGeneratedInteractionModelModules(absoluteModuleDir, interactionModelFiles, isSrc, isLibrary);
        if (await (0, util_1.isDir)(absoluteModuleDir)) {
            return {
                config,
                modules: [...sourceModules, ...interactionModelModules],
                responseTemplates,
                slotTypes,
                interactionModels: interactionModelFiles,
            };
        }
    }
    return undefined;
}
exports.loadPackage = loadPackage;
/**
 * Loads a package config from a directory.
 *
 * A package is identified by a `package.json` file - an ASK package must be a valid NPM package.
 *
 * Additionally, an ASK package either contains an `ask` section in `package.json` or as a supplemental `ask.json` file.
 *
 * @param dir root directory of the package to load.
 */
function loadPackageConfigSync(dir) {
    var _a, _b;
    const pkgJsonPath = path_1.default.join(dir, "package.json");
    const pkgJson = (0, util_1.readJsonFileSync)(pkgJsonPath);
    if (pkgJson === undefined) {
        return undefined;
    }
    if (pkgJson.ask === undefined) {
        const askJsonPath = path_1.default.join(dir, "ask.json");
        if ((0, util_1.isFileSync)(askJsonPath)) {
            pkgJson.ask = (0, util_1.readJsonFileSync)(askJsonPath);
            if (pkgJson.ask === undefined) {
                throw new Error(`invalid ASK configuration: '${askJsonPath}'`);
            }
        }
        else {
            // is not an ASK package.
            return undefined;
        }
    }
    // fill default values if fields are not specified
    pkgJson.ask.outDir = (_a = pkgJson.ask.outDir) !== null && _a !== void 0 ? _a : exports.DefaultBuildDir;
    pkgJson.ask.srcDir = (_b = pkgJson.ask.srcDir) !== null && _b !== void 0 ? _b : exports.DefaultInclude;
    // projectVersion is an internal configuration only, so we must ignore any loaded value.
    pkgJson.ask.projectVersion = ProjectVersion.Latest;
    return pkgJson;
}
exports.loadPackageConfigSync = loadPackageConfigSync;
/**
 * Loads a package config from a directory.
 *
 * A package is identified by a `package.json` file - an ASK package must be a valid NPM package.
 *
 * Additionally, an ASK package either contains an `ask` section in `package.json` or as a supplemental `ask.json` file.
 *
 * @param dir root directory of the package to load.
 */
async function loadPackageConfig(dir) {
    var _a, _b;
    const pkgJsonPath = path_1.default.join(dir, "package.json");
    const pkgJson = await (0, util_1.readJsonFile)(pkgJsonPath);
    if (pkgJson === undefined) {
        return undefined;
    }
    if (pkgJson.ask === undefined) {
        const askJsonPath = path_1.default.join(dir, "ask.json");
        if (await (0, util_1.isFile)(askJsonPath)) {
            pkgJson.ask = await (0, util_1.readJsonFile)(askJsonPath);
            if (pkgJson.ask === undefined) {
                throw new Error(`invalid ASK configuration: '${askJsonPath}'`);
            }
        }
        else {
            // is not an ASK package.
            return undefined;
        }
    }
    // fill default values if fields are not specified
    pkgJson.ask.outDir = (_a = pkgJson.ask.outDir) !== null && _a !== void 0 ? _a : exports.DefaultBuildDir;
    pkgJson.ask.srcDir = (_b = pkgJson.ask.srcDir) !== null && _b !== void 0 ? _b : exports.DefaultInclude;
    // projectVersion is an internal configuration only, so we must ignore any loaded value.
    pkgJson.ask.projectVersion = ProjectVersion.Latest;
    return pkgJson;
}
exports.loadPackageConfig = loadPackageConfig;
/**
 * Load ACDL and ASK Module source directory.
 *
 * @param baseDir directory to recursively scan
 */
function loadSourceDirectorySync(baseDir) {
    return load(baseDir);
    function load(subDir) {
        const files = fs_extra_1.default.readdirSync(subDir);
        return files
            .map((file) => {
            file = path_1.default.join(subDir, file);
            if ((0, util_1.isDirSync)(file)) {
                return load(file);
            }
            if (file.endsWith(".acdl")) {
                return [(0, parse_1.loadACDLFileSync)(baseDir, file, undefined)];
            }
            if ((0, util_1.isGeneratedFile)(file) && file.endsWith(".json")) {
                return [];
            }
            if (file.endsWith(".json")) {
                const loadedSourceFile = (0, parse_1.loadModuleFileSync)(baseDir, file);
                if (!loadedSourceFile) {
                    return [(0, source_file_1.sourceFile)(baseDir, file, undefined)];
                }
                return [
                    (0, source_file_1.sourceFile)(loadedSourceFile.baseDir, loadedSourceFile.uri, loadedSourceFile.content, [
                        ...(loadedSourceFile.errors || []),
                        error_factory_1.ValidationErrorFactory.ACDLCompilationSkipped({
                            attributes: {
                                filePath: file,
                            },
                        }),
                    ]),
                ];
            }
            return [
                (0, source_file_1.sourceFile)(baseDir, file, new ask.Module(file, ask.ModuleSchema), [
                    error_factory_1.ValidationErrorFactory.ACDLCompilationSkipped({
                        attributes: {
                            filePath: file,
                        },
                    }),
                ]),
            ];
        })
            .reduce((a, b) => a.concat(b), []);
    }
}
exports.loadSourceDirectorySync = loadSourceDirectorySync;
/**
 * Load ACDL and ASK Module source directory.
 *
 * @param baseDir directory to recursively scan
 */
async function loadSourceDirectory(baseDir) {
    return load(baseDir);
    async function load(subDir) {
        const files = await (0, util_1.readdir)(subDir);
        return (await Promise.all(files.map(async (file) => {
            file = path_1.default.join(subDir, file);
            if (await (0, util_1.isDir)(file)) {
                return load(file);
            }
            if (file.endsWith(".acdl")) {
                return [await (0, parse_1.loadACDLFile)(baseDir, file, undefined)];
            }
            if ((0, util_1.isGeneratedFile)(file) && file.endsWith(".json")) {
                return [];
            }
            if (file.endsWith(".json")) {
                const loadedSourceFile = await (0, parse_1.loadModuleFile)(baseDir, file);
                if (!loadedSourceFile) {
                    return [(0, source_file_1.sourceFile)(baseDir, file, undefined)];
                }
                return [
                    (0, source_file_1.sourceFile)(loadedSourceFile.baseDir, loadedSourceFile.uri, loadedSourceFile.content, [
                        ...(loadedSourceFile.errors || []),
                        error_factory_1.ValidationErrorFactory.ACDLCompilationSkipped({
                            attributes: {
                                filePath: file,
                            },
                        }),
                    ]),
                ];
            }
            return [
                (0, source_file_1.sourceFile)(baseDir, file, new ask.Module(file, ask.ModuleSchema), [
                    error_factory_1.ValidationErrorFactory.ACDLCompilationSkipped({
                        attributes: {
                            filePath: file,
                        },
                    }),
                ]),
            ];
        }))).reduce((a, b) => a.concat(b), []);
    }
}
exports.loadSourceDirectory = loadSourceDirectory;
/**
 * We load this manifest file which is output by the `ac-core/bundle.js` script. We use it to
 * determine the version of a bundled `@alexa/schema` or `@alexa/ac-core` library to load.
 */
const libManifest = require("../lib/manifest.json");
/**
 * Load ASKIR folders from a package bundled within the `lib/` folder.
 *
 * @param name name of the package
 * @returns the bundled ASK Package.
 */
function loadBundledPackageSync(name) {
    const version = libManifest.versions[`@alexa/${name}`];
    if (version === undefined) {
        throw new Error(`unknown bundled package '${name}'`);
    }
    const dir = path_1.default.join(__dirname, "..", "..", "dist", "lib", `${name}-${version}`);
    return asPackage(loadSourceDirectorySync(dir));
    function asPackage(modules) {
        return {
            modules: modules.filter((m) => m.content !== undefined),
            config: {
                name: `@alexa/${name}`,
                version,
            },
        };
    }
}
exports.loadBundledPackageSync = loadBundledPackageSync;
/**
 * Load ASKIR folders from a package bundled within the `lib/` folder.
 *
 * @param name name of the package
 * @returns the bundled ASK Package.
 */
async function loadBundledPackage(name) {
    const version = libManifest.versions[`@alexa/${name}`];
    if (version === undefined) {
        throw new Error(`unknown bundled package '${name}'`);
    }
    const dir = path_1.default.join(__dirname, "..", "..", "dist", "lib", `${name}-${version}`);
    return asPackage(await loadSourceDirectory(dir));
    function asPackage(modules) {
        return {
            modules: modules.filter((m) => m.content !== undefined),
            config: {
                name: `@alexa/${name}`,
                version,
            },
        };
    }
}
exports.loadBundledPackage = loadBundledPackage;
/**
 * Load the Project's prompts from `responses/prompts`.
 *
 * @param config project configuration
 */
function loadResponseTemplatesSync(dir) {
    return ask.ResponseTemplateType.All.map((type) => {
        const promptsPath = path_1.default.join(dir, "response", getResponseTemplatePath(type));
        if ((0, util_1.isDirSync)(promptsPath)) {
            return fs_extra_1.default.readdirSync(promptsPath).map((file) => new ask.ResponseTemplate(path_1.default.resolve(promptsPath, file), file, type));
        }
        return [];
    }).reduce((a, b) => { var _a; return (_a = a === null || a === void 0 ? void 0 : a.concat(b)) !== null && _a !== void 0 ? _a : []; }, []);
}
exports.loadResponseTemplatesSync = loadResponseTemplatesSync;
/**
 * Load the Project's prompts from `responses/prompts`.
 *
 * @param config project configuration
 */
async function loadResponseTemplates(dir) {
    return (await Promise.all(ask.ResponseTemplateType.All.map(async (type) => {
        const promptsPath = path_1.default.join(dir, "response", getResponseTemplatePath(type));
        if (await (0, util_1.isDir)(promptsPath)) {
            return (await (0, util_1.readdir)(promptsPath)).map((file) => new ask.ResponseTemplate(path_1.default.resolve(promptsPath, file), file, type));
        }
        return [];
    }))).reduce((a, b) => a === null || a === void 0 ? void 0 : a.concat(b), []);
}
exports.loadResponseTemplates = loadResponseTemplates;
function getResponseTemplatePath(type) {
    if (type === ask.ResponseTemplateType.Display) {
        return constants_1.Constants.DisplayFolderName;
    }
    return constants_1.Constants.PromptsFolderName;
}
/**
 * Synchronously Load Interaction Models' file path.
 *
 * @param config project configuration
 */
function getInteractionModelFilesSync(dir) {
    const interactionModels = [];
    const imDir = path_1.default.join(dir, "interactionModels", "custom");
    if ((0, util_1.isDirSync)(imDir)) {
        const fileNames = fs_extra_1.default.readdirSync(imDir);
        for (const fileName of fileNames) {
            const file = path_1.default.parse(fileName);
            const locale = file.name;
            file.name = file.name.replace("-", "_");
            if (file.ext === ".json" && Object.values(ask.Locale).includes(file.name)) {
                const imPath = path_1.default.join(imDir, fileName);
                if ((0, util_1.isFileSync)(imPath)) {
                    interactionModels.push({
                        file: imPath,
                        locale: locale,
                    });
                }
            }
        }
    }
    return interactionModels;
}
exports.getInteractionModelFilesSync = getInteractionModelFilesSync;
/**
 * Asynchronously Load Interaction Models' file path.
 *
 * @param config project configuration
 */
async function getInteractionModelFiles(dir) {
    const interactionModels = [];
    const imDir = path_1.default.join(dir, "interactionModels", "custom");
    if (await (0, util_1.isDir)(imDir)) {
        const fileNames = await (0, util_1.readdir)(imDir);
        for (const fileName of fileNames) {
            const file = path_1.default.parse(fileName);
            const locale = file.name;
            file.name = file.name.replace("-", "_");
            if (file.ext === ".json" && Object.values(ask.Locale).includes(file.name)) {
                const imPath = path_1.default.join(imDir, fileName);
                if (await (0, util_1.isFile)(imPath)) {
                    interactionModels.push({
                        file: imPath,
                        locale: locale,
                    });
                }
            }
        }
    }
    return interactionModels;
}
exports.getInteractionModelFiles = getInteractionModelFiles;
/**
 * Synchronously load the JSON from the project's interaction model files into a locale to model map.
 *
 * @param interactionModelFiles the interaction model files to load
 */
function loadInteractionModelsContentSync(interactionModelsFiles) {
    const interactionModels = new Map();
    for (const interactionModelFile of interactionModelsFiles) {
        const model = (0, util_1.readJsonFileSync)(interactionModelFile.file);
        if (model) {
            const locale = interactionModelFile.locale.replace("-", "_");
            interactionModels.set(locale, model);
        }
    }
    return interactionModels;
}
exports.loadInteractionModelsContentSync = loadInteractionModelsContentSync;
/**
 * Asynchronously load the JSON from the project's interaction model files into a locale to model map.
 *
 * @param interactionModelFiles the interaction model files to load
 */
async function loadInteractionModelsContent(interactionModelsFiles) {
    const interactionModels = new Map();
    await Promise.all(interactionModelsFiles.map(async (interactionModelFile) => {
        const model = await (0, util_1.readJsonFile)(interactionModelFile.file);
        if (model) {
            const locale = interactionModelFile.locale.replace("-", "_");
            interactionModels.set(locale, model);
        }
    }));
    return interactionModels;
}
exports.loadInteractionModelsContent = loadInteractionModelsContent;
/**
 * Load slot types from a project's Interaction Models.
 *
 * @param models a map of locales to interaction model json
 */
function loadSlotTypes(models) {
    var _a, _b, _c;
    const typeToLocale = new Map();
    for (const [locale, model] of models) {
        // Need this to support UI interaction models https://github.com/alexa/ask-ac/issues/1187
        if (model.interactionModel === undefined) {
            model.interactionModel = {
                languageModel: model.languageModel,
            };
        }
        const types = (_a = model === null || model === void 0 ? void 0 : model.interactionModel) === null || _a === void 0 ? void 0 : _a.languageModel.types;
        const slotTypes = (_b = types === null || types === void 0 ? void 0 : types.filter((t) => (t === null || t === void 0 ? void 0 : t.name) !== undefined)) !== null && _b !== void 0 ? _b : [];
        for (const slot of slotTypes) {
            if ((0, util_1.isBuiltinSlotType)(slot.name)) {
                continue;
            }
            else if (typeToLocale.has(slot.name)) {
                (_c = typeToLocale.get(slot.name)) === null || _c === void 0 ? void 0 : _c.push(locale);
            }
            else {
                typeToLocale.set(slot.name, [locale]);
            }
        }
    }
    const slots = [];
    for (const [name, locale] of typeToLocale) {
        slots.push(new ask.SlotType(new ask.Name(`slotTypes.${name}`), locale));
    }
    return slots.length > 0 ? slots : undefined;
}
exports.loadSlotTypes = loadSlotTypes;
/**
 * Scan all folders in a directory for ask packages and return all their Module files.
 *
 * @param dir directory to scan for packages.
 */
function scanPackagesSync(dir) {
    // throw error if we can't access this directory
    try {
        fs_extra_1.default.accessSync(dir, fs_extra_1.default.constants.R_OK);
    }
    catch (err) {
        if (err.code === "ENOENT") {
            // no such file, so return empty
            return [];
        }
        // file exists but we can't read - throw.
        throw err;
    }
    if ((0, util_1.isFileSync)(dir)) {
        // ignore files, we're only looking inside folders
        return [];
    }
    const packageJson = path_1.default.join(dir, "package.json");
    if ((0, util_1.isFileSync)(packageJson)) {
        // this folder is a NPM package
        const node_modules = path_1.default.join(dir, "node_modules");
        const config = loadPackageConfigSync(dir);
        if (config !== undefined) {
            // this package contains ASK artifacts
            return [loadPackageSync(dir, config, false), ...scanPackagesSync(node_modules)].filter((p) => p !== undefined);
        }
        // package is not an ASK package, but it may still containing dependencies in its node_modules that are, let's check them too
        return scanPackagesSync(node_modules);
    }
    // the folder is not an ASK package, it may be an NPM organization, i.e, @alexa/.., so let's check all the folders contained within.
    const ls = fs_extra_1.default.readdirSync(dir).map((d) => path_1.default.join(dir, d));
    const scan = ls.map((p) => scanPackagesSync(p));
    return scan.reduce((a, b) => a.concat(b), []);
}
exports.scanPackagesSync = scanPackagesSync;
/**
 * Scan all folders in a directory for ask packages and return all their Module files.
 *
 * @param dir directory to scan for packages.
 */
async function scanPackages(dir) {
    // throw error if we can't access this directory
    try {
        await fs_extra_1.default.access(dir, fs_extra_1.default.constants.R_OK);
    }
    catch (err) {
        if (err.code === "ENOENT") {
            // no such file, so return empty
            return [];
        }
        // file exists but we can't read - throw.
        throw err;
    }
    if (await (0, util_1.isFile)(dir)) {
        // ignore files, we're only looking inside folders
        return [];
    }
    const packageJson = path_1.default.join(dir, "package.json");
    if (await (0, util_1.isFile)(packageJson)) {
        // this folder is a NPM package
        const node_modules = path_1.default.join(dir, "node_modules");
        const config = await loadPackageConfig(dir);
        if (config !== undefined) {
            // this package contains ASK artifacts
            return [(await loadPackage(dir, config, false)), ...(await scanPackages(node_modules))].filter((p) => p !== undefined);
        }
        // package is not an ASK package, but it may still containing dependencies in its node_modules that are, let's check them too
        return scanPackages(node_modules);
    }
    // the folder is not an ASK package, it may be an NPM organization, i.e, @alexa/.., so let's check all the folders contained within.
    const ls = (await (0, util_1.readdir)(dir)).map((d) => path_1.default.join(dir, d));
    const scan = await Promise.all(ls.map((p) => scanPackages(p)));
    return scan.reduce((a, b) => a.concat(b), []);
}
exports.scanPackages = scanPackages;
/**
 * Loads generated interaction model modules from the directory if it is a source
 * package and not a library.
 *
 * @param dir the directory to mock the source location of the modules.
 * @param imFiles the interaction model files to generate.
 * @param isSrc whether the package contains source or external modules
 * @param isLibrary whether the package is a NPM library.
 * @returns the generated interaction model modules.
 */
function loadGeneratedInteractionModelModulesSync(dir, imFiles, isSrc, isLibrary) {
    if (isSrc && !isLibrary) {
        return new im_module_generator_1.InteractionModelModuleGenerator(dir, imFiles).generateInteractionModelModulesSync();
    }
    return [];
}
exports.loadGeneratedInteractionModelModulesSync = loadGeneratedInteractionModelModulesSync;
/**
 * Loads generated interaction model modules from the directory if it is a source
 * package and not a library.
 *
 * @param dir the directory to mock the source location of the modules.
 * @param imFiles the interaction model files to generate.
 * @param isSrc whether the package contains source or external modules
 * @param isLibrary whether the package is a NPM library.
 * @returns the generated interaction model modules.
 */
async function loadGeneratedInteractionModelModules(dir, imFiles, isSrc, isLibrary) {
    if (isSrc && !isLibrary) {
        return new im_module_generator_1.InteractionModelModuleGenerator(dir, imFiles).generateInteractionModelModules();
    }
    return [];
}
exports.loadGeneratedInteractionModelModules = loadGeneratedInteractionModelModules;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFja2FnZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9wYWNrYWdlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsZ0RBQXdCO0FBQ3hCLHdEQUEwQjtBQUMxQiwyQ0FBNkI7QUFFN0IsK0NBQXFEO0FBQ3JELGlDQUF5STtBQUV6SSwyQ0FBc0M7QUFDdEMsbUNBQTJGO0FBRTNGLG1EQUF1RDtBQUN2RCwrREFBc0U7QUFDdEUsNkRBQTJEO0FBb0gzRDs7R0FFRztBQUNILElBQVksY0FZWDtBQVpELFdBQVksY0FBYztJQUN4Qjs7T0FFRztJQUNILGlDQUFlLENBQUE7SUFDZjs7T0FFRztJQUNILGlDQUFlLENBQUE7SUFFZix1Q0FBcUIsQ0FBQTtJQUNyQixrQ0FBYyxDQUFBO0FBQ2hCLENBQUMsRUFaVyxjQUFjLEdBQWQsc0JBQWMsS0FBZCxzQkFBYyxRQVl6QjtBQWFEOztHQUVHO0FBQ1UsUUFBQSxlQUFlLEdBQUcsT0FBTyxDQUFDO0FBQ3ZDOztHQUVHO0FBQ1UsUUFBQSxjQUFjLEdBQUcsS0FBSyxDQUFDO0FBRXBDOzs7Ozs7Ozs7O0dBVUc7QUFDSCxTQUFnQixlQUFlLENBQUMsT0FBZSxFQUFFLE1BQWtDLEVBQUUsS0FBYzs7SUFDakcsTUFBTSxHQUFHLE1BQU0sYUFBTixNQUFNLGNBQU4sTUFBTSxHQUFJLHFCQUFxQixDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQ2xELE1BQU0sU0FBUyxHQUFHLE1BQUEsTUFBQSxNQUFNLGFBQU4sTUFBTSx1QkFBTixNQUFNLENBQUUsR0FBRywwQ0FBRSxPQUFPLG1DQUFJLEtBQUssQ0FBQztJQUVoRCxJQUFJLEtBQUssSUFBSSxNQUFNLEtBQUssU0FBUyxFQUFFO1FBQ2pDLHlEQUF5RDtRQUV6RCxNQUFNLGVBQWUsR0FBRyxjQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxlQUFlLENBQUMsQ0FBQztRQUU1RCxNQUFNLENBQUMs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